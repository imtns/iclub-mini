require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages-fengge/baogai/create"],{"039a":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=c(n("b645")),i=c(n("c9f5")),r=n("ca00"),a=n("1dac"),s=n("26cb");function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g={mixins:[i.default],data:function(){return{init:!1,loading:!0,showErrorPicture:!1,gender:"",imageUrl:"",templateList:[],initGender:"",fengGeList:[],errorMessage:"",creating:!1,fengGe:"",scrollLeft:"",templateCode:"",option:{},shareInfo:{title:"一键爆改，测测你的颜值有多绝",path:"/pages-fengge/entry",imageUrl:"https://imeikud.oss-cn-beijing.aliyuncs.com/iclub/images/share/share-baogai.jpeg"},genderFengGeCache:{},templateCache:{}}},computed:l({},(0,s.mapState)(["isLogin"])),watch:{gender:{handler:function(e){var t=this;if(this.genderFengGeCache[e])return this.fengGeList=this.genderFengGeCache[e],this.fengGe=this.fengGeList[0],void this.getTemplate();(0,a.getFenggeByGender)({gender:e}).then((function(n){var o=n.data,i=o.map((function(e){return e.fengGe}));t.fengGeList=i,setTimeout((function(){console.log(123123);var e=i.findIndex((function(e){return e===t.fengGe}));t.scrollLeft=e>-1?100*e:0}),500),t.genderFengGeCache[e]=i,t.initGender!==e&&(t.fengGe=i[0]),t.getTemplate()}))}},fengGe:{handler:function(){this.getTemplate()}}},beforeDestroy:function(){(0,r.lsDel)("detectFace")},onShow:function(){if(console.log(123),this.init||this.isLogin){var e=(0,r.lsGet)("detectFace");e?this.imageUrl=e:this.isLogin&&!this.fengGe&&(this.option.gender?(this.gender=this.option.gender,this.fengGe=this.option.fengGe,this.initGender=this.option.gender):(this.gender="女",this.fengGe="中性风"))}},onLoad:function(e){var t=this;if((0,r.lsDel)("detectFace"),!this.isLogin)return this.option=e,void this.goLogin();e.gender?(this.gender=e.gender,this.fengGe=e.fengGe,this.initGender=e.gender):(this.gender="女",this.fengGe="中性风"),setTimeout((function(){t.init=!0}),200)},methods:{handleAction:function(t){if(console.log("type",t),"camera"===t)wx.navigateTo({url:"/pages-fengge/baogai/photo"});else{var n=this;e.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(e){var t="image",o=e.tempFiles[0].path;n.aliUploadFun(o,t,e)}})}this.$refs.popPhoto.close()},aliUploadFun:function(e,t,n){var i=this;wx.showLoading(),o.default.upload(e,t,(function(e){console.log("datas----------",e),e?(console.log("图片上传成功",e),i.imageUrl=e):console.log("图片上传失败，请稍后重试"),wx.hideLoading()}))},handleTakePhoto:function(){this.$refs.popPhoto.open()},handleTemplateClick:function(e){this.templateCode=this.templateCode===e.objectCode?"":e.objectCode},getTemplate:function(){var e=this;this.templateList=[];var t="".concat(this.gender,"_").concat(this.fengGe);if(console.log("123"),this.templateCode="",this.templateCache[t])return this.loading=!1,void(this.templateList=this.templateCache[t]);(0,a.getStyleTemplate)({fengGe:this.fengGe,gender:this.gender}).then((function(n){var o,i=n.data;e.loading=!1;var r=(null===i||void 0===i||null===(o=i[0])||void 0===o?void 0:o.templateList)||[];e.templateList=r,e.templateCache[t]=r}))},goUrl:function(e,t,n){this.isLogin?(this.report(n),wx.navigateTo({url:e})):this.goLogin()},handleCreateBaogai:function(){var e=this;this.isLogin?this.creating||(this.report("生成爆改图"),console.log("创建爆改图",this.templateCode),this.templateCode?this.imageUrl?(this.creating=!0,(0,a.generateBaogaiFace)({methodName:"handleCreateBaogai",templateImageCode:this.templateCode,uploadImageUrl:"".concat(this.imageUrl,"?x-oss-process=image/resize,m_mfit,w_1000/format,jpg")}).then((function(e){var t=e.data;console.log("result",t),wx.navigateTo({url:"/pages-fengge/baogai/result?src=".concat(t.changeImageUrl,"&code=").concat(t.objectCode)})})).catch((function(t){t.message.includes("captcha")||(e.showErrorPicture=!0,e.errorMessage=t.message)})).finally((function(){(0,r.lsDel)("detectFace"),setTimeout((function(){e.creating=!1}),300)}))):this.$refs.toast.show({message:"请上传照片"}):this.$refs.toast.show({message:"请选择模板照片"})):this.goLogin()}}};t.default=g}).call(this,n("543d")["default"])},"0419":function(e,t,n){},"2dee":function(e,t,n){"use strict";n.r(t);var o=n("039a"),i=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=i.a},6662:function(e,t,n){"use strict";(function(e){n("6cdc");o(n("66fd"));var t=o(n("f5bc"));function o(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n("543d")["createPage"])},6981:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}));var o={xContent:function(){return n.e("components/x/content").then(n.bind(null,"9fa5"))},ikCustomHeader:function(){return Promise.all([n.e("common/vendor"),n.e("components/common/custom-header")]).then(n.bind(null,"3e50"))},xImg:function(){return n.e("components/x/img").then(n.bind(null,"b303"))},xFooter:function(){return n.e("components/x/footer").then(n.bind(null,"9424"))},xBtn:function(){return n.e("components/x/btn").then(n.bind(null,"4f71"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"27c0"))},xPop:function(){return n.e("components/x/pop").then(n.bind(null,"3bb2"))},xToast:function(){return n.e("components/x/toast").then(n.bind(null,"f8a6"))},globalCaptcha:function(){return Promise.all([n.e("common/vendor"),n.e("components/global/captcha")]).then(n.bind(null,"2e67"))},globalPrivacyPopup:function(){return n.e("components/global/privacy-popup").then(n.bind(null,"abb5"))}},i=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.gender="女"},e.e1=function(t){e.gender="男"},e.e2=function(t,n){var o=arguments[arguments.length-1].currentTarget.dataset,i=o.eventParams||o["event-params"];n=i.fengge;e.fengGe=n},e.e3=function(t){return e.$refs.pop.open()},e.e4=function(t){return e.$refs.pop.close()},e.e5=function(t){return e.$refs.popPhoto.close()},e.e6=function(t){return e.$refs.popPhoto.close()},e.e7=function(t){e.showErrorPicture=!1})},r=[]},"895c":function(e,t,n){"use strict";var o=n("9035"),i=n.n(o);i.a},9035:function(e,t,n){},"9f59":function(e,t,n){"use strict";var o=n("0419"),i=n.n(o);i.a},f5bc:function(e,t,n){"use strict";n.r(t);var o=n("6981"),i=n("2dee");for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);n("895c"),n("9f59");var a,s=n("f0c5"),c=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,"2a94f790",null,!1,o["a"],a);t["default"]=c.exports}},[["6662","common/runtime","common/vendor","pages-fengge/common/vendor"]]]);