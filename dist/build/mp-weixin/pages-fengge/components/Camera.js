require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages-fengge/components/Camera"],{"349c":function(e,t,i){},"57dc":function(e,t,i){"use strict";i.r(t);var n=i("5ef3"),a=i("a3ed");for(var o in a)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(o);i("b051");var c,s=i("f0c5"),r=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,"05012ccb",null,!1,n["a"],c);t["default"]=r.exports},"5ef3":function(e,t,i){"use strict";var n;i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var a=function(){var e=this,t=e.$createElement;e._self._c},o=[]},a3ed:function(e,t,i){"use strict";i.r(t);var n=i("bcba"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},b051:function(e,t,i){"use strict";var n=i("349c"),a=i.n(n);a.a},bcba:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i("6ce9");function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){c(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var s=function(){i.e("pages-fengge/components/FaceDetect").then(function(){return resolve(i("13d1"))}.bind(null,i)).catch(i.oe)},r={components:{FaceDetect:s},props:{loading:Boolean,avalible:{type:Boolean,default:!1}},data:function(){return o({ctx:null,showTakePicture:!0,image:null,lock:!1,isTakeByClick:!1,flashMaskVisible:!1,comfirmVisible:!1,faceDirection:"front",canvasWidth:0,canvasHeight:0,_currentBrightness:0,_innerAudioContext:null,_currentVoiceType:null,_frame:null,_shooting:!1,isPaused:!1},n.initialState)},watch:{avalible:function(e){e&&(this._shooting=!1,this.faceDirection="front",this.isPaused=!1,this.setPlayVoice("lockEyes",0))}},created:function(){this.initialVoice(),this.detectFace()},beforeDestroy:function(){wx.stopFaceDetect(),this._innerAudioContext&&this._innerAudioContext.destroy(),this.ctx&&this.ctx.onCameraFrame(null)},methods:{initialVoice:function(){var e=this;this._innerAudioContext=wx.createInnerAudioContext(),wx.setInnerAudioOption({obeyMuteSwitch:!1}),this._innerAudioContext.onEnded((function(){e._currentVoiceType=null,2===e.faceState&&e.readyTakePhoto()}))},detectFace:function(){var e=this;(0,n.initFaceDetect)().then((function(){e.ctx=wx.createCameraContext(),e.ctx.onCameraFrame(e.onCameraFrame).start({fail:function(t){wx.stopFaceDetect(),e.faceState=0}})}))},onCameraFrame:function(e){var t=this;this.isPaused||(this._frame=e,this.canvasWidth||(this.canvasWidth=e.width,this.canvasHeight=e.height),this.avalible&&!this._shooting&&(0,n.faceDetext)(e,(function(e){console.error("faceDectcé”™è¯¯",e),t.showTakePicture=!0}),(function(i){var a=(0,n.validFaceDetect)({result:i,frame:e,faceDirection:t.faceDirection}),o=a.faceState,c=a.playVoice;t.setPlayVoice(c,o)})))},setPlayVoice:function(e,t){this._innerAudioContext&&e!==this._currentVoiceType&&!this._currentVoiceType&&this.avalible&&(this.faceState=t,this.playVoice="kaca"===e?"stay":e,this._shooting&&"kaca"!==e||(this._currentVoiceType=e,this._innerAudioContext.src="https://imeikud.oss-cn-beijing.aliyuncs.com/iclub/mp3/".concat(n.voiceSourceMap[e],".mp3"),this._innerAudioContext.play()))},readyTakePhoto:function(){var e=this;!this.avalible||this.comfirmVisible||this._shooting||(this._shooting=!0,this.takePhoto().then((function(t){console.log("path",t),e.image=t,e.comfirmVisible=!0})).catch((function(t){console.log(t),e.faceState=t.faceState,e.setPlayVoice(t.playVoice),e._shooting=!1})))},takePhotoByClick:function(){var e=this;this.isPaused=!0,this._innerAudioContext.pause(),this.ctx.takePhoto({quality:"high",success:function(t){e.setPlayVoice("kaca",0),e.isTakeByClick=!0,e.lock=!0,e.image=t.tempImagePath,e.comfirmVisible=!0,console.log("ðŸš€ ~ takePhoto ~ tempImagePath:",t.tempImagePath)}})},takePhoto:function(){return console.log("take photo"),this.isValidFrame()},isValidFrame:function(){var e=this,t={width:this._frame.width,height:this._frame.height,data:new Uint8ClampedArray(this._frame.data)};return console.error("frame",t),new Promise((function(i,a){wx.faceDetect({frameBuffer:t.data.buffer,width:t.width,height:t.height,enableAngle:!0,success:function(o){var c=(0,n.validFaceDetect)({result:o,frame:t,faceDirection:e.faceDirection}),s=c.faceState,r=c.playVoice;2===s?i({faceState:s,playVoice:r}):a({faceState:s,playVoice:r})},fail:function(e){a(e)}})})).then((function(){return e.savePhoto(t)}))},savePhoto:function(t){var i=this,n=1200/t.width,a=2e3/t.height,c=Math.min(n,a,1),s=t.width*c,r=t.height*c;console.log("destWidth",s),console.log("destHeight",r);var u=this;return e.canvasPutImageData(o({canvasId:"photoCanvas",x:0,y:0},t),this).then((function(t){return new Promise((function(t,n){e.canvasToTempFilePath({canvasId:"photoCanvas",fileType:"jpg",quality:.9,destWidth:s,destHeight:r,success:function(e){u.setPlayVoice("kaca",0),t(e.tempFilePath)},fail:n},i)}))}))},setScreenBrightness:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;return wx.getScreenBrightness().then((function(t){return e._currentBrightness=t.value,e.setDataSync({flashMaskVisible:!0})})).then((function(){return wx.setScreenBrightness({value:1})})).then((function(){return new Promise((function(e){setTimeout(e,t)}))}))},rephotograph:function(){this.image=null,this.loading=!1,this.lock=!1,this.comfirmVisible=!1,this._shooting=!1,this.isTakeByClick=!1,this._innerAudioContext.play(),this.isPaused=!1,this.setPlayVoice("lockEyes",0)},ensure:function(){this.lock=!0,this.isTakeByClick=!1,this.isPaused=!1,e.$emit("getPreviewImage",this.image)}}};t.default=r}).call(this,i("543d")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'pages-fengge/components/Camera-create-component',
    {
        'pages-fengge/components/Camera-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("57dc"))
        })
    },
    [['pages-fengge/components/Camera-create-component']]
]);
