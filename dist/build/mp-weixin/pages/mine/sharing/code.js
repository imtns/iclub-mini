require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mine/sharing/code"],{"1b10":function(t,e,n){"use strict";var o=n("4d66"),i=n.n(o);i.a},"3f30":function(t,e,n){"use strict";n.r(e);var o=n("4dcd"),i=n("8812");for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);n("1b10");var r,s=n("f0c5"),c=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,"78a98361",null,!1,o["a"],r);e["default"]=c.exports},"4d66":function(t,e,n){},"4dcd":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return o}));var o={xLoading:function(){return n.e("components/x/loading").then(n.bind(null,"cbe3"))},ikCustomHeader:function(){return Promise.all([n.e("common/vendor"),n.e("components/common/custom-header")]).then(n.bind(null,"3e50"))},xBtn:function(){return n.e("components/x/btn").then(n.bind(null,"4f71"))},lPainter:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/lime-painter/components/l-painter/l-painter")]).then(n.bind(null,"7a1c"))},globalCaptcha:function(){return Promise.all([n.e("common/vendor"),n.e("components/global/captcha")]).then(n.bind(null,"2e67"))},globalPrivacyPopup:function(){return n.e("components/global/privacy-popup").then(n.bind(null,"abb5"))},xToast:function(){return n.e("components/x/toast").then(n.bind(null,"f8a6"))}},i=function(){var t=this,e=t.$createElement,n=(t._self._c,t.hidePhoneNumber(t.userInfo.phone));t._isMounted||(t.e0=function(e){t.path=e}),t.$mp.data=Object.assign({},{$root:{m0:n}})},a=[]},8812:function(t,e,n){"use strict";n.r(e);var o=n("ae39"),i=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);e["default"]=i.a},"9e81":function(t,e,n){"use strict";(function(t){n("6cdc");o(n("66fd"));var e=o(n("3f30"));function o(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])},ae39:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n("3583"),i=n("ed08"),a=n("ca00"),r=n("ed08");function s(t){return f(t)||u(t)||l(t)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(t,e){if(t){if("string"===typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}function u(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function f(t){if(Array.isArray(t))return p(t)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var h={name:"sharingCode",components:{},data:function(){return{scrollTop:0,loading:!0,captchaClose:!1,saveAlbumImgOne:!0,saveAlbumImgTow:!1,shareInfo:{title:"",path:"/pages/home/index"},isLogin:t.hasLogin(),ShareImg:(0,a.lsGet)("qrImg"),tmpBgPath:"",userInfo:this.lsGet("userInfo"),saveBgImg:"https://udstatic.imeik.com/pcUploads/1705371369616/share_save_bg.png",cssTextNormal:{type:"text",text:"",css:{fontSize:"28rpx",fontWeight:"400",fontFamily:"PingFangSC-Regular, PingFang SC",color:"#FFFFFF",textAlign:"right",top:"",left:"",position:"absolute"}}}},onPageScroll:function(t){this.scrollTop=t.scrollTop},mounted:function(){var e=getCurrentPages().reverse(),n=e[0]&&e[0].route;t.$off("captcha-".concat(n,"-close"),this.detectCaptchaClose),t.$on("captcha-".concat(n,"-close"),this.detectCaptchaClose),this.isLogin?(this.getQrCode(),this.shareInfo.title=this.userInfo.nickName+"邀请您加入爱美客粉丝会员CLUB"):this.loading=!1},methods:{detectCaptchaClose:function(){this.loading=!1,this.captchaClose=!0},hidePhoneNumber:function(t){if(t)return 11===t.length?t.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):t},getTempPath:function(t){var e=this;(0,i.base6ImageToTempPath)(t,{succ:function(t,n){e.tmpBgPath=t}})},getQrCode:function(){var t=this;if(this.loading=!0,this.captchaClose=!1,this.ShareImg)return this.getTempPath(this.ShareImg),void(this.loading=!1);var e=getApp().globalData.userInfo||{};(0,o.apiQRCode)({page:"pages/home/index",appId:(0,r.getCurrentAppId)(),methodName:"getQrCode",isHyaline:!1,scene:"inviteCode=".concat(e.objectCode)}).then((function(e){t.loading=!1,(0,a.ls)("qrImg",e),t.ShareImg=e,t.getTempPath(e)}))},saveAlbum:function(){var t=this;wx.getSetting({success:function(e){e.authSetting["scope.writePhotosAlbum"]?t.savePhoto():wx.authorize({scope:"scope.writePhotosAlbum",success:function(){t.savePhoto()},fail:function(){t.saveAlbumImgTow=!0,t.saveAlbumImgOne=!1}})},fail:function(t){console.log(t)}})},takeopen:function(){var t=this;wx.openSetting({success:function(e){console.log("openSetting success"),t.savePhoto(),t.saveAlbumImgTow=!1,t.saveAlbumImgOne=!0},fail:function(t){console.log("openSetting fail",t)}})},savePhoto:function(){wx.showLoading();var t=[{type:"image",src:this.userInfo.headUrl,css:{width:"180rpx",height:"180rpx",borderRadius:"50%",top:"110rpx",left:"286rpx",position:"absolute","object-fit":"cover"}},{type:"text",text:this.userInfo.nickName,css:{fontSize:"36rpx",fontWeight:"bold",fontFamily:"PingFangSC-Semibold, PingFang SC",color:"#001226",textAlign:"center",top:"370rpx",left:"50%",transform:"translateX(-50%)",position:"absolute"}},{type:"text",text:this.hidePhoneNumber(this.userInfo.phone),css:{fontSize:"26rpx",fontWeight:"400",fontFamily:"PingFangSC-Regular, PingFang SC",color:"#5A6067",textAlign:"center",top:"430rpx",left:"50%",transform:"translateX(-50%)",position:"absolute"}},{type:"image",src:this.tmpBgPath,css:{width:"440rpx",height:"440rpx",top:"476rpx",left:"154rpx",position:"absolute"}},{type:"view",text:"",css:{position:"absolute",top:"944rpx",width:"100%",left:"50%",transform:"translateX(-50%)",textAlign:"center"},views:[{type:"text",text:this.userInfo.nickName,css:{fontSize:"28rpx",fontWeight:"bold",color:"#001226"}},{type:"text",text:" 邀请您",css:{fontSize:"28rpx",fontWeight:"400",color:"#001226"}}]},{type:"text",text:"加入爱美客粉丝会员club",css:{fontSize:"28rpx",fontWeight:"400",fontFamily:"PingFangSC-Regular, PingFang SC",color:"#001226",textAlign:"center",left:"50%",transform:"translateX(-50%)",top:"988rpx",position:"absolute"}}];this.saveImage(this.saveBgImg,t)},saveImage:function(e,n){var o=this,i={css:{width:"750rpx"},views:[{type:"image",src:e,css:{width:"750rpx"}}].concat(s(n))};i.views.map((function(t){return"text"===t.type&&(t.text+=""),t})),console.log(JSON.stringify(i)),this.$refs.painter.render(i),this.$nextTick((function(){o.$refs.painter.canvasToTempFilePathSync({fileType:"jpg",quality:1,success:function(e){console.log(e.tempFilePath),wx.hideLoading();var n=o;t.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(){n.$refs.toast.show({message:"图片已保存到相册"})},fail:function(t){console.log(t),t.errMsg.includes("cancel")||n.handleOpenSetting()}})}})}))}}};e.default=h}).call(this,n("543d")["default"])}},[["9e81","common/runtime","common/vendor"]]]);